<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
 <html><head>
<!-- Original URL: http://www.92csz.com/study/linux/21.htm
Date Downloaded: 2016/3/26 13:56:55 !-->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 
 <meta name="description" content="配置Squid服务" />
 <meta name="keywords" content="nginx,freebsd,linux,mysql,shell,apache,centos,redhat,rhel,windows,sql,系统运维,IT运维,开源系统,开源系统运维" />
 <title> 配置Squid服务  </title>
 <!-- base href="http://www.92csz.com/" -->
 </head>
 <body bgcolor="#FFFFFF" text="#000000"><div style="z-index: 9999; position: fixed; width: 100%; border: 0px; padding: 5px; margin: 0px; background-color: transparent;  font-size: 12pt; font-family: sans-serif;" id="web2disk_nag" onclick="javascript: document.getElementById('web2disk_nag').style.display = 'none';">
		<div style="color: #000000; background-color:#F1F1F1; margin-left: auto; margin-right: auto; border-width: 2px; border-style: solid; width: 550px; ">
			<div style="width: 100%; text-align: center; font-weight: bold; border: 0px; margin: 0px; padding: 0px">Hey, where did my words go? (Click to hide)</div>
			<p>In the trial version of Web2Disk every fifth word is blanked out. 
			To copy this site with all the words, please upgrade to the full version and copy this website again.</p>
			<div style="width: 100%; text-align: center; font-weight: bold; border: 0px; margin: 0px; padding: 0px">
				<a href="http://www.inspyder.com/products/Web2Disk/">Inspyder Web2Disk: The Website Downloader</a>
			</div>
		</div>
	</div>
 <div id="menu">
	 <ul>
		 <span style="FONT-SIZE: 10.5pt">
			 <li style="float:right;list-style-type:none;"><a href="http://www.92csz.com/" hidefocus="true" id="mn_list">返回网站首页 </a></li>
			 <li><a href="index.html" hidefocus="true" id="mn_list">linux入门教程 </a></li>
			 <li><a href="http://www.92csz.com/search" hidefocus="true" id="mn_search">搜索 </a></li>
		 </span>
	 </ul>
 </div>
 <p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: center" align="center"><b style="font-weight: normal"><span style="FONT-SIZE: 15pt; FONT-FAMILY: 宋体;">第二十一章 </span></b><b style="font-weight: normal"><span style="FONT-SIZE: 15pt"><font face="Calibri">  </font></span></b><b style="font-weight: normal"><span style="FONT-SIZE: 15pt; FONT-FAMILY: 宋体;">配置 </span></b><b style="font-weight: normal"><span style="FONT-SIZE: 15pt"><font face="Calibri">squid </font></span></b><b style="font-weight: normal"><span style="FONT-SIZE: 15pt; FONT-FAMILY: 宋体;">服务 </span></b><b style="font-weight: normal"><span style="FONT-SIZE: 15pt"><!--?xml:namespace prefix = o ns = "urn:schemas-microsoft-com:office:office" /--><o:p></o:p></span></b></p>
 <p><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">【 <b style="font-weight: normal">什么是 </b></span><b style="font-weight: normal"><span style="font-size: 10.5pt"><font face="Calibri">squid </font></span></b><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">】 </span></p>
 <p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 21pt"><span style="font-size: 10.5pt"><font face="Calibri">Squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">是比较知名的代理软件，它不仅可以跑在 </span><span style="font-size: 10.5pt"><font face="Calibri">linux </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">上还可以跑在 </span><span style="font-size: 10.5pt"><font face="Calibri">windows </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">以及 </span><span style="font-size: 10.5pt"><font face="Calibri">Unix </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">上，它的技术已经非常成熟。目前使用 </span><span style="font-size: 10.5pt"><font face="Calibri">Squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">的用户也是十分广泛的。 </span><span style="font-size: 10.5pt"><font face="Calibri">Squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">与 </span><span style="font-size: 10.5pt"><font face="Calibri">Linux </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">下其它的代理软件如 </span><span style="font-size: 10.5pt"><font face="Calibri">Apache </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">、 </span><span style="font-size: 10.5pt"><font face="Calibri">Socks </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">、 </span><span style="font-size: 10.5pt"><font face="Calibri">TIS FWTK </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">和 </span><span style="font-size: 10.5pt"><font face="Calibri">delegate </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">相比，下载安装简单，配置简单灵活，支持缓存和多种协议。 </span><span style="font-size: 10.5pt"><o:p></o:p></span></p>
 <p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 21pt"><span style="font-size: 10.5pt"><font face="Calibri">Squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">的缓存功能相当好用，不仅可以减少带宽的占用，同样也大大降低了后台的 </span><span style="font-size: 10.5pt"><font face="Calibri">WEB </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">服务器的磁盘 </span><span style="font-size: 10.5pt"><font face="Calibri">I/O </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">的压力。 </span><span style="font-size: 10.5pt"><font face="Calibri">Squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">接收用户的下载申请，并自动处理所下载的数据。也就是说，当一个用户象要下载一个主页时，它向 </span><span style="font-size: 10.5pt"><font face="Calibri">Squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">发出一个申请，要 </span><span style="font-size: 10.5pt"><font face="Calibri">Squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">替它下载，然后 </span><span style="font-size: 10.5pt"><font face="Calibri">Squid  </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">连接所申请网站并请求该主页，接着把该主页传给用户同时保留一个备份，当别的用户申请同样的页面时， </span><span style="font-size: 10.5pt"><font face="Calibri">Squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">把保存的备份立即传给用户，使用户觉得速度相当快。 </span><span style="font-size: 10.5pt"><font face="Calibri">  <span><o:p></o:p></span></font></span></p>
 <p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 21pt"><span style="font-size: 10.5pt"><font face="Calibri">Squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">将数据元缓存在内存中，同时也缓存 </span><span style="font-size: 10.5pt"><font face="Calibri">DNS </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">查寻的结果，除此之外，它还支持非模块化的 </span><span style="font-size: 10.5pt"><font face="Calibri">DNS </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">查询，对失败的请求进行消极缓存。 </span><span style="font-size: 10.5pt"><font face="Calibri">Squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">支持 </span><span style="font-size: 10.5pt"><font face="Calibri">SSL </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">，支持访问控制。由于使用了 </span><span style="font-size: 10.5pt"><font face="Calibri">ICP </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">， </span><span style="font-size: 10.5pt"><font face="Calibri">Squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">能够实现重叠的代理阵列，从而最大限度的节约带宽。 </span><span style="font-size: 10.5pt"><font face="Calibri">  <span><o:p></o:p></span></font></span></p>
 <p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 21pt"><span style="font-size: 10.5pt"><font face="Calibri">Squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">对硬件的要求是内存一定要大，不应小于 </span><span style="font-size: 10.5pt"><font face="Calibri">128M </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">，硬盘转速越快越好，最好使用服务器专用 </span><span style="font-size: 10.5pt"><font face="Calibri">SCSI  </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">硬盘，处理器要求不高， </span><span style="font-size: 10.5pt"><font face="Calibri">400MH </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">以上既可。 </span></p>
 <script async="" src="../../../pagead2.googlesyndication.com/pagead/js/f.txt.js"></script>
 <!-- study_zsy -->
 <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5865024608655371" data-ad-slot="4214051509" data-ad-format="auto"></ins>
 <script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
 <p><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">【 <b style="font-weight: normal">安装 </b></span><b style="font-weight: normal"><span style="font-size: 10.5pt"><font face="Calibri">squid </font></span></b><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">】 </span></p>
 <p><span style="font-size: 10.5pt"><font face="Calibri">wget&nbsp;http://www.squid-cache.org/Versions/v2/2.6/squid-2.6.STABLE20.tar.gz <o:p></o:p></font></span></p>
 <p><span style="font-size: 10.5pt"><font face="Calibri">tar zxvf squid-2.6.STABLE20.tar.gz <o:p></o:p></font></span></p>
 <p><span style="font-size: 10.5pt"><font face="Calibri">cd squid-2.6.STABLE20 <br />ulimit -HSn 65535 <o:p></o:p></font></span></p>
 <p><span style="font-size: 10.5pt"><font face="Calibri">useradd <span style="mso-spacerun: yes">&nbsp;  </span>squid <br /></font></span><span class="ttag"><span style="FONT-FAMILY: 宋体; font-size: 10.5pt"><span onclick="tagshow(event)" href="tag.php?name=%B1%E0%D2%EB">编译 </span><span onclick="tagshow(event)" href="tag.php?name=%B2%CE%CA%FD">参数 </span></span></span><span style="font-size: 10.5pt"><br /><font face="Calibri">./ <span class="ttag"><span onclick="tagshow(event)" href="tag.php?name=conf">conf </span></span>igure --prefix=/usr/local/squid \ <br />--disable-dependency-tracking \ <br />--enable-dlmalloc \ <br />--enable-gnuregex \ <br />--disable-carp \ <br />--enable-async-io=240 \ <br />--with-pthreads \ <br />--enable-storeio=ufs,aufs,diskd,null \ <br />--disable-wccp \ <br />--disable-wccpv2 \ <br />--enable-kill-parent-hack \ <br />--enable-cachemgr-hostname=localhost \ <br />--enable-default-err-language=Simplify_Chinese \ <br />--with-build-environment=POSIX_V6_ILP32_OFFBIG \ <br />--with-maxfd=65535 \ <br />--with-aio \ <br />--disable-poll \ <br />--enable-epoll \ <br />--enable-linux-netfilter \ <br />--enable-large-cache-files \ <br />--disable-ident-lookups \ <br />--enable-default-hostsfile=/etc/hosts \ <br />--with-dl \ <br />--with-large-files \ <br />--enable-removal-policies=heap,lru \ <br />--enable-delay-pools \ <br />--enable-snmp \ <br />--disable-internal-dns <br /><br />make &amp;&amp; make  <span class="ttag"><span onclick="tagshow(event)" href="tag.php?name=install">install </span><o:p></o:p></span></font></span></p>
 <!--++ plugin_code qcomic begin-->
 <p><span class="ttag"><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">关于 </span></span><span class="ttag"><span style="font-size: 10.5pt"><font face="Calibri">squid </font></span></span><span class="ttag"><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">的版本，有必要提一下，目前 </span></span><span class="ttag"><span style="font-size: 10.5pt"><font face="Calibri">squid </font></span></span><span class="ttag"><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">最新版本已经到了 </span></span><span class="ttag"><span style="font-size: 10.5pt"><font face="Calibri">3.1 </font></span></span><span class="ttag"><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">了，但是笔者认为 </span></span><span class="ttag"><span style="font-size: 10.5pt"><font face="Calibri">2.6 </font></span></span><span class="ttag"><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">版本比较好用，如果你有兴趣可以研究一下 </span></span><span class="ttag"><span style="font-size: 10.5pt"><font face="Calibri">3.1 </font></span></span><span class="ttag"><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">。 </span></span></p>
 <p><span class="ttag"><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">【 </span></span><span class="ttag"><b style="font-weight: normal"><span style="font-size: 10.5pt"><font face="Calibri">squid </font></span></b></span><span class="ttag"><b style="font-weight: normal"><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">配置 </span></b></span><span class="ttag"><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">】 </span></span></p>
 <p><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">编辑配置文件 </span><span style="font-size: 10.5pt"><font face="Calibri"> /usr/local/squid/etc/squid.conf <o:p></o:p></font></span></p>
 <p><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">把原来配置文件删除，替换成： </span></p>
 <p><span style="font-size: 10.5pt"><font face="Calibri">http_port 80 transparent <br /><br />cache_replacement_policy lru <span style="mso-spacerun: yes">&nbsp;  </span># </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">如果有多个（下面两行）缓存目录，则需要写这个参数 </span><span style="font-size: 10.5pt"><br /><font face="Calibri" size="3">cache_dir aufs  <span style="mso-spacerun: yes">&nbsp; </span>/cache1 8192 16 256 <span style="mso-spacerun: yes">&nbsp;  </span># </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">缓存目录 </span><span style="font-size: 10.5pt"><font face="Calibri">1 /cache1  </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">大小为 </span><span style="font-size: 10.5pt"><font face="Calibri">8G <br />cache_dir aufs /cache2 4096 16 256 <span style="mso-spacerun: yes">&nbsp;  </span># </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">缓存目录 </span><span style="font-size: 10.5pt"><font face="Calibri">2 /cache2  </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">大小为 </span><span style="font-size: 10.5pt"><font face="Calibri">4G <o:p></o:p></font></span></p>
 <p><span style="font-size: 10.5pt"><font face="Calibri">##  </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">上面两行定义了缓存目录，这个缓存目录可以只有一个，也可以定义很多个。 </span><span style="font-size: 10.5pt"><br /><font face="Calibri" size="3">cache_mem 2048 MB <span style="mso-spacerun: yes">&nbsp;  </span># </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">分配多少内存给 </span><span style="font-size: 10.5pt"><font face="Calibri">squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">，建议留至少 </span><span style="font-size: 10.5pt"><font face="Calibri">512M </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">给系统，如果你是虚拟机内存很小，只作为试验用的话，那就分一半内存给 </span><span style="font-size: 10.5pt"><font face="Calibri">squid <br />maximum_object_size 2048 KB <span style="mso-spacerun: yes">&nbsp;  </span># </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">缓存的文件最大不能超过 </span><span style="font-size: 10.5pt"><font face="Calibri">2M <br />maximum_object_size_in_memory 512 KB # </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">缓存在内存中的文件最大不超过 </span><span style="font-size: 10.5pt"><font face="Calibri">512k <br />visible_hostname cache.example.com  <span style="mso-spacerun: yes">&nbsp; </span># </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">显示给用户的主机名 </span><span style="font-size: 10.5pt"><font face="Calibri" size="3">  </font><span><br /><font face="Calibri" size="3">client_persistent_connections off <span style="mso-spacerun: yes">&nbsp;  </span>#client </font></span></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">端关闭长连接 </span><span style="font-size: 10.5pt"><br /><font face="Calibri" size="3">server_persistent_connections on <span style="mso-spacerun: yes">&nbsp;  </span>#server </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">端打开长连接 </span><span style="font-size: 10.5pt"><br /><font face="Calibri" size="3">memory_pools on <br />memory_pools_limit 1024 MB <br />forwarded_for on <br />log_icp_queries off <br />cache_mgr  <span style="mso-spacerun: yes">&nbsp; </span><span style="COLOR: #333333">cache@example.com </span><span style="mso-spacerun: yes">&nbsp;  </span># </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">定义管理员的 </span><span style="font-size: 10.5pt"><font face="Calibri">mail </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">为 </span><span style="font-size: 10.5pt"><font face="Calibri">cache@example.com <br />via on <br />httpd_suppress_version_string off <br />cache_effective_user squid <span style="mso-spacerun: yes">&nbsp;&nbsp;  </span># </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">定义以 </span><span style="font-size: 10.5pt"><font face="Calibri">squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">用户的身份运行 </span><span style="font-size: 10.5pt"><font face="Calibri">squid <br />cache_effective_group squid <br />error_directory /usr/local/squid/share/errors/Simplify_Chinese <br />icon_directory /usr/local/squid/share/icons <br />mime_table /usr/local/squid/etc/mime. <span class="ttag"><span onclick="tagshow(event)" href="tag.php?name=conf">conf </span></span><br />ie_refresh off <br />tcp_recv_bufsize 32 KB <br /><br />acl all src 0.0.0.0/0.0.0.0 <br />acl localhost src 127.0.0.0/8  <br />acl Mgr_ip src 127.0.0.0/8  <br />acl allow_ip dst 127.0.0.0/8&nbsp;&nbsp;192.168.0.0/16 <span style="mso-spacerun: yes">&nbsp;  </span># </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">定义允许代理的 </span><span style="font-size: 10.5pt"><font face="Calibri">web </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">的 </span><span style="font-size: 10.5pt"><font face="Calibri">IP </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">或者 </span><span style="font-size: 10.5pt"><font face="Calibri">IP </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">段 </span><span style="font-size: 10.5pt"><br /><font face="Calibri" size="3">acl PURGE method PURGE <br />acl Safe_ports port 80 8080 <br />acl CONNECT method CONNECT <br />acl manager proto cache_object <br />acl HTTP proto HTTP <br /><br />http_access allow allow_ip <br />http_access allow manager Mgr_ip <br />http_access deny manager <br />http_access deny PURGE <br />http_access deny !Safe_ports <br />http_access deny all <br />icp_access deny all <br />ipcache_size 1024 <br />ipcache_low 90 <br />ipcache_high 95 <br />memory_replacement_policy lru <br />hosts_file /etc/hosts <br />request_header_max_size 128 KB <br />hierarchy_stoplist cgi-bin ? \.php \.____ <br />acl QUERY urlpath_regex cgi-bin \? \.php \.html <br />cache deny QUERY <br />quick_abort_min -1 KB <br />quick_abort_max 32 KB <br />quick_abort_pct 95 <br /># error page <br />#error_map  </font><a href="http://www.92csz.com/404.html" target="_blank"><span style="COLOR: #333333; TEXT-DECORATION: none; text-underline: none"><font face="Calibri" size="3">http://www.92csz.com/404.html </font></span></a><font face="Calibri" size="3"> 403 <br />#deny_info  </font><a href="http://www.92csz.com/error.html" target="_blank"><span style="COLOR: #333333; TEXT-DECORATION: none; text-underline: none"><font face="Calibri" size="3">http://www.92csz.com/error.html </font></span></a><font face="Calibri"> cctv_Domain <br /># timeout <br />peer_connect_timeout 20 seconds <br />connect_timeout 20 seconds <br />read_timeout 60 seconds <br />request_timeout 20 seconds <br />pconn_timeout 20 seconds <br />shutdown_lifetime 5 seconds <br />strip_query_terms off <br />icp_port 0 <br /># logfile <br />emulate_httpd_log on <br />logformat combined %&gt;a %ui %__ [%tl] "%rm %ru HTTP/%rv" %__ %&lt;st "%{Referer}&gt;h" "%{User-Agent}&gt;h" %Ss:%Sh <br />#access_log /log/squid-log/access.log combined <br />cache_store_log /dev/null <br />cache_log /var/log/squid/cache.log <br />logfile_rotate 12 <br /># MISCELLANEOUS <br />store_objects_per_bucket 15 <br />client_db off <o:p></o:p></font></span></p>
 <!--++ plugin_code qcomic begin-->
 <p><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">修改完配置文件后保存，然后初始化 </span><span style="font-size: 10.5pt"><font face="Calibri">squid </font></span></p>
 <p><b style="font-weight: normal"><span style="font-size: 10.5pt"><font face="Calibri">mkdir /cache1 <span style="mso-spacerun: yes">&nbsp;  </span>/cache2 /var/log/squid <o:p></o:p></font></span></b></p>
 <p><b style="font-weight: normal"><span style="font-size: 10.5pt"><font face="Calibri">chown -R squid:squid /cache1 /_____2 /var/log/squid <o:p></o:p></font></span></b></p>
 <p><font face="Calibri"><b style="font-weight: normal"><span style="font-size: 10.5pt">/usr/local/squid/sbin/squid  </span></b><span style="font-size: 10.5pt"><span style="mso-spacerun: yes">&nbsp; </span><b style="font-weight: normal">-z </b>  <span style="mso-spacerun: yes">&nbsp; </span><o:p></o:p></span></font></p>
 <p><span style="font-size: 10.5pt"><font face="Calibri">#  </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">用来生成 </span><span style="font-size: 10.5pt"><font face="Calibri">cache </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">目录，如果你的配置文件配置出错，往往会在初始化的时候报错，错误信息会直接显示在屏幕上。初始化成功后，就可以启动 </span><span style="font-size: 10.5pt"><font face="Calibri">squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">了，启动命令为： </span><span style="font-size: 10.5pt"><o:p></o:p></span></p>
 <p><b style="font-weight: normal"><span style="font-size: 10.5pt"><font face="Calibri">nohup /usr/local/squid/bin/RunCache &amp; <o:p></o:p></font></span></b></p>
 <p><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">启动后，可以去看看 </span><span style="font-size: 10.5pt"><font face="Calibri">cache.log  </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">在这个日志中，你可以看到很多关于 </span><span style="font-size: 10.5pt"><font face="Calibri">squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">的信息，当然也包括一些错误日志。 </span><span style="font-size: 10.5pt"><o:p></o:p></span></p>
 <p><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">如果想开机启动则需要在 </span><span style="font-size: 10.5pt"><font face="Calibri">/etc/rc.d/rc.local </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">中最后加入一行 </span><span style="font-size: 10.5pt"><o:p></o:p></span></p>
 <p><span style="font-size: 10.5pt"><font face="Calibri">/usr/local/bin/RunCache &amp; </font></span></p>
 <p><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">到这里算是配置完成了，但是还有一个问题，就是如何定义被代理的 </span><span style="font-size: 10.5pt"><font face="Calibri">web </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">以及域名？单单看配置文件并没有说代理的 </span><span style="font-size: 10.5pt"><font face="Calibri">web </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">是哪一个。确实，这个配置文件其实可以代理多台 </span><span style="font-size: 10.5pt"><font face="Calibri">web </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">，只要你在 </span><span style="font-size: 10.5pt"><font face="Calibri">/etc/hosts </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">中定义要代理的域名以及 </span><span style="font-size: 10.5pt"><font face="Calibri">IP </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">即可， </span><span style="font-size: 10.5pt"><font face="Calibri">hosts </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">格式在前面已经介绍过。笔者要提醒你的是， <span style="COLOR: red">如果是一台 </span></span><span style="COLOR: red; font-size: 10.5pt"><font face="Calibri">web </font></span><span style="COLOR: red; FONT-FAMILY: 宋体; font-size: 10.5pt">上的多个域名，请不要写一行，虽然 </span><span style="COLOR: red; font-size: 10.5pt"><font face="Calibri">hosts </font></span><span style="COLOR: red; FONT-FAMILY: 宋体; font-size: 10.5pt">是允许的，但是如果写成一个 </span><span style="COLOR: red; font-size: 10.5pt"><font face="Calibri">IP </font></span><span style="COLOR: red; FONT-FAMILY: 宋体; font-size: 10.5pt">对应多个域名， </span><span style="COLOR: red; font-size: 10.5pt"><font face="Calibri">squid </font></span><span style="COLOR: red; FONT-FAMILY: 宋体; font-size: 10.5pt">代理时就会出错。所以有几个域名就要写几行。 </span></p>
 <p><span style="COLOR: red; FONT-FAMILY: 宋体; font-size: 10.5pt"></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">更改 </span><span style="font-size: 10.5pt"><font face="Calibri">/etc/hosts </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">后要重启 </span><span style="font-size: 10.5pt"><font face="Calibri">squid </font></span><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">才能生效： </span><span style="font-size: 10.5pt"><o:p></o:p></span></p>
 <p><b style="font-weight: normal"><span style="font-size: 10.5pt"><font face="Calibri">/usr/local/squid/sbin/squid <span style="mso-spacerun: yes">&nbsp;  </span>-krec </font></span></b></p>
 <p><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">在重启前可以先检测一下，是否有错，命令为： </span><span style="font-size: 10.5pt"><o:p></o:p></span></p>
 <p><b style="font-weight: normal"><span style="font-size: 10.5pt"><font face="Calibri">/usr/local/squid/sbin/squid –kcheck </font></span></b></p>
 <p><span style="FONT-FAMILY: 宋体; font-size: 10.5pt">如果没有错，则不会显示任何信息，否则会显示一些信息出来。 </span></p>
 <div><script type="text/javascript"><!--
google_ad_client = "ca-pub-5865024608655371";
google_ad_slot = "3514991827";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
 <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/f.txt.js">
</script></div>
 <p><span style="FONT-SIZE: 10.5pt;">上一页&nbsp; <a title="" href="20.htm">配置FTP服务 </a></span><span style="FONT-SIZE: 10.5pt;">&nbsp;&nbsp; </span></p>
 <p><span style="FONT-SIZE: 10.5pt;">下一页&nbsp; <a title="" href="22.htm">配置Tomcat </a></span><span style="FONT-SIZE: 10.5pt;">&nbsp;&nbsp; </span></p>
 <p><span style="FONT-SIZE: 10.5pt;"><a title="" href="index.html">回到主目录 </a></span></p>
 <script src="../../../s20.cnzz.com/stat_a61bedf.php.js" language="JavaScript"></script>
 </body></html>an></p>
 <script src="http://s20.cnzz.com/stat.php?id=3037570&web_id=3037570&show=pic" language="JavaScript"></script>
 </body></html>