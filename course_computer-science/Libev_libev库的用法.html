<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>libev库的用法 | 学步园</title> 
<meta name="description" content="libev是一个高性能的事件循环库，比libevent库的性能要好。Nodejs就是采用它作为底层库。libev的官方文档在 这里 ，文档比较长。本文结合里面的例子对它的用法做些简单的总结。" />
<meta name="keywords" content="" />
<link rel="stylesheet" href="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/style.css" type="text/css" media="screen" />
<link rel="stylesheet" href="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/css/css.css" />
<link rel="stylesheet" href="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/css/highlight.css" />
<link rel="stylesheet" href="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/css/img.css" />
<link rel="pingback" href="http://www.xuebuyuan.com/xmlrpc.php" />
<link rel="shortcut icon" href="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/images/favicon.ico" />
<script type="text/javascript" src="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/js/jquery.min.js" ></script>
<link rel="alternate" type="application/rss+xml" title="学步园 &raquo; Feed" href="http://www.xuebuyuan.com/feed" />
<link rel="alternate" type="application/rss+xml" title="学步园 &raquo; 评论Feed" href="http://www.xuebuyuan.com/comments/feed" />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://www.xuebuyuan.com/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.xuebuyuan.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.xuebuyuan.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='crash reporting system for Windows applications' href='http://www.xuebuyuan.com/442281.html' />
<link rel='next' title='为什么结婚戒指要戴在无名指上' href='http://www.xuebuyuan.com/8857.html' />
<meta name="generator" content="WordPress 3.8" />
<link rel='canonical' href='http://www.xuebuyuan.com/1733575.html' />
<link rel='shortlink' href='http://www.xuebuyuan.com/?p=1733575' />
		<link href="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/styles/4-blue.css" rel="stylesheet" type="text/css" />

<style type="text/css">
.banner img{
	margin: 0 0 5px 0;
}
</style>

<script type="text/javascript" src="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/comments-ajax.js"></script>
<script type="text/javascript" src="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/js/reply.js"></script>
<script type="text/javascript" src="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/js/custom.js"></script>
<script type="text/javascript" src="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/js/superfish.js"></script>
<script type="text/javascript" src="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/js/mousewheel.js"></script>
<script type="text/javascript" src="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/js/fancybox.js"></script>
<script type="text/javascript">
	$(document).ready(function() {

		$("a[rel=example_group]").fancybox({
			'transitionIn'		: 'none',
			'transitionOut'		: 'none',
			'titlePosition' 	: 'over',
			'titleFormat'		: function(title, currentArray, currentIndex, currentOpts) {
				return '<span id="fancybox-title-over">共 ' + currentArray.length + ' 张图片，当前第 ' + (currentIndex + 1) +' 张 '+ (title.length ? ' &nbsp; ' + title : '') + '</span>';
			}
		});

		$("#various").fancybox({
			'padding'			: 0,
			'autoScale'			: false,
			'transitionIn'		: 'none',
			'transitionOut'		: 'none'
		});
		$("#download").fancybox({
			'transitionIn'		: 'none',
			'transitionOut'		: 'none'
		});
	});
</script>
<script type="text/javascript">
$(function () {
$('.thumbnail img,.thumbnail_t img,.box_comment img,#slideshow img,.cat_ico,.cat_name,.r_comments img,.v_content_list img').hover(
function() {$(this).fadeTo("fast", 0.5);},
function() {$(this).fadeTo("fast", 1);
});
});
</script>
<!-- PNG -->
<!--[if lt IE 7]>
<script type="text/javascript" src="http://www.xuebuyuan.com/wp-content/themes/HotNewspro/js/pngfix.js"></script>
<script type="text/javascript">
DD_belatedPNG.fix('.boxCaption,.top_box,.logo,.reply,.imgcat,.banner img,#fancybox-left-ico,#fancybox-right-ico,#fancybox-close');
</script>
<![endif]-->
<!-- 图片延迟加载 -->
<script type="text/javascript" src="http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/js/lazyload.js"></script>
<script type="text/javascript">
	$(function() {          
    	$(".entry_box img,.entry_box_h img,#entry img,.entry_b img").lazyload({
            effect:"fadeIn",
			failurelimit : 30
          });
    	});
</script>
<!-- IE6菜单 -->
<script type="text/javascript"><!--//--><![CDATA[//><!--
sfHover = function() {
	if (!document.getElementsByTagName) return false;
	var sfEls = document.getElementById("menu").getElementsByTagName("li");

	for (var i=0; i<sfEls.length; i++) {
		sfEls[i].onmouseover=function() {
			this.className+=" sfhover";
		}
		sfEls[i].onmouseout=function() {
			this.className=this.className.replace(new RegExp(" sfhover\\b"), "");
		}
	}	
	var sfEls = document.getElementById("topnav").getElementsByTagName("li");
	for (var i=0; i<sfEls.length; i++) {
		sfEls[i].onmouseover=function() {
			this.className+=" sfhover";
		}
	}
}
if (window.attachEvent) window.attachEvent("onload", sfHover);
//--><!]]></script>
<!-- 预加载 -->
</head>
<body class="single single-post postid-1733575 single-format-standard zh">
<div id="wrapper">
	<div id="top">
		<div id='topnav'>
			<div class="left_top ">
				<div class="home_h"><a href="http://www.xuebuyuan.com" title="首  页" class="home_h"></a></div>
				<div class="menu-%e5%af%bc%e8%88%aa-container"><ul id="menu-%e5%af%bc%e8%88%aa" class="menu"><li id="menu-item-1703978" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703978"><a href="http://www.xuebuyuan.com/category/web%e5%89%8d%e7%ab%af">web前端</a></li>
<li id="menu-item-1703980" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703980"><a href="http://www.xuebuyuan.com/category/%e6%95%b0%e6%8d%ae%e5%ba%93">数据库</a></li>
<li id="menu-item-1703982" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703982"><a href="http://www.xuebuyuan.com/category/%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80">编程语言</a></li>
<li id="menu-item-1703979" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703979"><a href="http://www.xuebuyuan.com/category/%e6%90%9c%e7%b4%a2%e6%8a%80%e6%9c%af">搜索技术</a></li>
<li id="menu-item-1810308" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1810308"><a href="http://www.xuebuyuan.com/aboutus">关于本站</a></li>
</ul></div> 
			</div>
			<!-- end: left_top --> 
			<div id="searchbar">
								<form action="http://www.xuebuyuan.com/search" id="cse-search-box">
	<div>
	<input type="hidden" name="cx" value="007504628711321185124:w-wufhldrhc" />
	<input type="hidden" name="cof" value="FORID:10" />
	<input type="text" onclick="this.value='';" name="q" id="q" class="swap_value" />
	<input type="image" src="http://www.xuebuyuan.com/wp-content/themes/HotNewspro/images/go.gif" id="go" alt="Search" title="搜索" />
	</div>
</form>							</div>
			<!-- end: searchbar -->
		</div>
		<!-- end: topnav -->
	</div>
	<!-- end: top -->
	<div id="header">
		<div class="header_c">
			<div class="login_t"><a id="showbtn"  onclick="showid('smallLay');">登录</a>  <div id="smallLay">
	<div id="smallLay_box">
	<!-- if not logged -->
	<form action="http://www.xuebuyuan.com/wp-login.php?redirect_to=http%3A%2F%2Fwww.xuebuyuan.com%2F1733575.html" method="post" id="loginform">
		<div class="loginblock">
			<p class="login"><input type="text" name="log" id="log" size="" tabindex="11" /></p>
			<p class="password"><input type="password" name="pwd" id="pwd"  size="" tabindex="12" /></p>
			<p class="lefted"><button value="Submit" id="submit_t" type="submit" tabindex="13">登&nbsp;录</button></p>
		</div>
		<input type="hidden" name="redirect_to" value="/1733575.html" />
		<input type="checkbox" name="rememberme" id="modlogn_remember" value="yes"  checked="checked" alt="Remember Me" />下次自动登录
	</form>
	<!-- end if not logged -->
	</div>
</div>
</div>
			<div class="time">
<script type="text/javascript">
today=new Date();
var day; var date; var hello;
hour=new Date().getHours()
if(hour < 6)hello='  凌晨好! '
else if(hour < 9)hello=' 早上好! '
else if(hour < 12)hello=' 上午好! '
else if(hour < 14)hello=' 中午好! '
else if(hour < 17)hello=' 下午好! '
else if(hour < 19)hello=' 傍晚好! '
else if(hour < 22)hello=' 晚上好! '
else {hello='夜深了! '}
var webUrl = webUrl;
document.write(' '+hello);
</script>
<span id=localtime>
<script type="text/javascript">
today=new Date(); var tdate,tday, x,year; var x = new Array("星期日", "星期一", "星期二", "星期三", "星期四", "星期五","星期六");
var MSIE=navigator.userAgent.indexOf("MSIE");
if(MSIE != -1)
year =(today.getFullYear());
else
year = (today.getYear()+1900);
tdate= year+ "年" + (today.getMonth() + 1 ) + "月" + today.getDate() + "日" + " " + x[today.getDay()];
document.write(tdate);
</script>
</span>
</div>			<a href="http://www.xuebuyuan.com" title="学步园"><h1 class="logo">学步园</h1></a>		</div>
		<div class="clear"></div>
		<!-- end: header_c -->

<script type="text/javascript">
var cpro_id="u2275153";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"980",rsi1:"250",pat:"6",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"1",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"",rss2:"#000000",titSU:"0",ptbg:"90",piw:"0",pih:"0",ptp:"0"}
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>

	</div>
	<!-- end: header -->
			<!-- header_image -->
		<div class="banner">
					</div>
		<!-- end:header_image -->
		<!-- scroll -->
	<ul class="scroll">
	<li class="sct">
		<a href="#">&nbsp;&nbsp;&nbsp;</a>
		<div><a class="scroll_t">返回顶部</a></div>
	</li>
		<li class="scc">
		<a href="#">&nbsp;&nbsp;&nbsp;</a>
		<div><a class="scroll_c">查看留言</a></div>
	</li>
		<li class="scb">
		<a href="#">&nbsp;&nbsp;&nbsp;</a>
		<div><a class="scroll_b">转到底部</a></div>
	</li>
</ul><script type="text/javascript">
    function doZoom(size) {
        var zoom = document.all ? document.all['entry'] : document.getElementById('entry');
        zoom.style.fontSize = size + 'px';
    }
</script>
<div id="content">
			 <!-- menu -->
		<div id="map">
			<div class="browse">现在的位置: <a title="返回首页" href="http://www.xuebuyuan.com/">首页</a> &gt; 综合 &gt; 正文</div>
			<div id="feed"><a href="http://www.xuebuyuan.com/feed" title="RSS">RSS</a></div>
		</div>
		<!-- end: menu -->
		<div class="entry_box_s">
			<div class="context">
				<div class="context_t">
					<span class="prev"></span>
					<span class="next"></span>
				</div>
			</div>
			<div class="entry_title_box">
				<!-- 分类图标 -->
				<div class="ico"></div>
				<!-- end: 分类图标 -->
				<h2 class="entry_title">libev库的用法</h2>
				<div class="archive_info">
					<span class="date">2013年02月25日</span>
					<span class="category"> &#8260; 综合</span>
										&#8260; 共 6054字					&#8260; 字号 <span class="font"><a href="javascript:doZoom(12)">小</a> <a href="javascript:doZoom(13)">中</a> <a href="javascript:doZoom(18)">大</a></span>
					<span class="comment"> &#8260; <span>评论关闭</span></span>
										<span class="edit"></span>
				</div>
			</div>
			<!-- end: entry_title_box -->
			<div class="entry">
				<div id="entry">
					<div class="ad_r">
	<script type="text/javascript">
    /*正文右侧中大矩形*/
    var cpro_id = "u1788635";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
</div>					<div id="article_content" class="article_content">
<p style="margin-top:0.5em; margin-bottom:0.5em; font-family:Arial,sans-serif; font-size:14px; line-height:19px">
libev是一个高性能的事件循环库，比libevent库的性能要好。Nodejs就是采用它作为底层库。libev的官方文档在 <a target="_blank" class="reference external" href="http://pod.tst.eu/http://cvs.schmorp.de/libev/ev.pod" style="color:rgb(9,61,114); text-decoration:none">这里</a> ，文档比较长。本文结合里面的例子对它的用法做些简单的总结。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em; font-family:Arial,sans-serif; font-size:14px; line-height:19px">
<div class="contents topic" id="contents" style="margin:2em; font-family:Arial,sans-serif; font-size:14px; line-height:19px">
<p class="topic-title first" style="margin-top:0.5em; margin-bottom:0.5em; font-weight:bold">
Contents</p>
<ul class="simple" style="margin:0.4em 0px">
<li style="list-style:circle"><a target="_blank" class="reference internal" href="http://www.yeolar.com/note/2012/12/16/libev/#id2" id="id6" style="color:rgb(9,61,114); text-decoration:none">例子</a></li>
<li style="list-style:circle"><a target="_blank" class="reference internal" href="http://www.yeolar.com/note/2012/12/16/libev/#id3" id="id7" style="color:rgb(9,61,114); text-decoration:none">事件循环</a></li>
<li style="list-style:circle"><a target="_blank" class="reference internal" href="http://www.yeolar.com/note/2012/12/16/libev/#id4" id="id8" style="color:rgb(9,61,114); text-decoration:none">观察器</a>
<ul>
<li style="list-style:circle"><a target="_blank" class="reference internal" href="http://www.yeolar.com/note/2012/12/16/libev/#ev-io" id="id9" style="color:rgb(9,61,114); text-decoration:none">ev_io</a></li>
<li style="list-style:circle"><a target="_blank" class="reference internal" href="http://www.yeolar.com/note/2012/12/16/libev/#ev-timer" id="id10" style="color:rgb(9,61,114); text-decoration:none">ev_timer</a></li>
<li style="list-style:circle"><a target="_blank" class="reference internal" href="http://www.yeolar.com/note/2012/12/16/libev/#ev-periodic" id="id11" style="color:rgb(9,61,114); text-decoration:none">ev_periodic</a></li>
<li style="list-style:circle"><a target="_blank" class="reference internal" href="http://www.yeolar.com/note/2012/12/16/libev/#ev-signal" id="id12" style="color:rgb(9,61,114); text-decoration:none">ev_signal</a></li>
<li style="list-style:circle"><a target="_blank" class="reference internal" href="http://www.yeolar.com/note/2012/12/16/libev/#ev-child" id="id13" style="color:rgb(9,61,114); text-decoration:none">ev_child</a></li>
<li style="list-style:circle"><a target="_blank" class="reference internal" href="http://www.yeolar.com/note/2012/12/16/libev/#ev-stat" id="id14" style="color:rgb(9,61,114); text-decoration:none">ev_stat</a></li>
</ul>
</li>
<li style="list-style:circle"><a target="_blank" class="reference internal" href="http://www.yeolar.com/note/2012/12/16/libev/#id5" id="id15" style="color:rgb(9,61,114); text-decoration:none">其他功能</a></li>
<li style="list-style:circle"><a target="_blank" class="reference internal" href="http://www.yeolar.com/note/2012/12/16/libev/#python" id="id16" style="color:rgb(9,61,114); text-decoration:none">Python绑定</a></li>
</ul>
</div>
<div class="section" id="id2" style="font-family:Arial,sans-serif; font-size:14px; line-height:19px">
<h1 style="font-size:17px; font-family:'Microsoft Yahei',sans-serif; color:rgb(26,28,29)">
<a target="_blank" class="toc-backref" href="http://www.yeolar.com/note/2012/12/16/libev/#id6" style="color:rgb(26,28,29); text-decoration:none">例子</a></h1>
<p style="margin-top:0.5em; margin-bottom:0.5em">首先从官方的例子开始：</p>
<pre class="code c literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><span class="c1" style="color:rgb(64,128,128); font-style:italic">// a single header file is required
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span><span class="cp" style="color:rgb(188,122,0)">#include &lt;ev.h&gt;
</span><span class="cp" style="color:rgb(188,122,0)"></span>
<span class="cp" style="color:rgb(188,122,0)">#include &lt;stdio.h&gt; </span><span class="c1" style="color:rgb(64,128,128); font-style:italic">// for puts
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>
<span class="c1" style="color:rgb(64,128,128); font-style:italic">// every watcher type has its own typedef'd struct
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic">// with the name ev_TYPE
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span><span class="n">ev_io</span> <span class="n">stdin_watcher</span><span class="p">;</span>
<span class="n">ev_timer</span> <span class="n">timeout_watcher</span><span class="p">;</span>

<span class="c1" style="color:rgb(64,128,128); font-style:italic">// all watcher callbacks have a similar signature
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic">// this callback is called when data is readable on stdin
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span><span class="k" style="color:rgb(0,128,0); font-weight:bold">static</span> <span class="kt" style="color:rgb(176,0,64)">void</span>
<span class="nf" style="color:rgb(0,0,255)">stdin_cb</span> <span class="p">(</span><span class="n">EV_P_</span> <span class="n">ev_io</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">w</span><span class="p">,</span> <span class="kt" style="color:rgb(176,0,64)">int</span> <span class="n">revents</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">puts</span> <span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"stdin ready"</span><span class="p">);</span>
  <span class="c1" style="color:rgb(64,128,128); font-style:italic">// for one-shot events, one must manually stop the watcher
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>  <span class="c1" style="color:rgb(64,128,128); font-style:italic">// with its corresponding stop function.
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>  <span class="n">ev_io_stop</span> <span class="p">(</span><span class="n">EV_A_</span> <span class="n">w</span><span class="p">);</span>

  <span class="c1" style="color:rgb(64,128,128); font-style:italic">// this causes all nested ev_run's to stop iterating
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>  <span class="n">ev_break</span> <span class="p">(</span><span class="n">EV_A_</span> <span class="n">EVBREAK_ALL</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1" style="color:rgb(64,128,128); font-style:italic">// another callback, this time for a time-out
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span><span class="k" style="color:rgb(0,128,0); font-weight:bold">static</span> <span class="kt" style="color:rgb(176,0,64)">void</span>
<span class="nf" style="color:rgb(0,0,255)">timeout_cb</span> <span class="p">(</span><span class="n">EV_P_</span> <span class="n">ev_timer</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">w</span><span class="p">,</span> <span class="kt" style="color:rgb(176,0,64)">int</span> <span class="n">revents</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">puts</span> <span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"timeout"</span><span class="p">);</span>
  <span class="c1" style="color:rgb(64,128,128); font-style:italic">// this causes the innermost ev_run to stop iterating
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>  <span class="n">ev_break</span> <span class="p">(</span><span class="n">EV_A_</span> <span class="n">EVBREAK_ONE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt" style="color:rgb(176,0,64)">int</span>
<span class="nf" style="color:rgb(0,0,255)">main</span> <span class="p">(</span><span class="kt" style="color:rgb(176,0,64)">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1" style="color:rgb(64,128,128); font-style:italic">// use the default event loop unless you have special needs
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>  <span class="k" style="color:rgb(0,128,0); font-weight:bold">struct</span> <span class="n">ev_loop</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">loop</span> <span class="o" style="color:rgb(102,102,102)">=</span> <span class="n">EV_DEFAULT</span><span class="p">;</span>

  <span class="c1" style="color:rgb(64,128,128); font-style:italic">// initialise an io watcher, then start it
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>  <span class="c1" style="color:rgb(64,128,128); font-style:italic">// this one will watch for stdin to become readable
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>  <span class="n">ev_io_init</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">stdin_watcher</span><span class="p">,</span> <span class="n">stdin_cb</span><span class="p">,</span> <span class="cm" style="color:rgb(64,128,128); font-style:italic">/*STDIN_FILENO*/</span> <span class="mi" style="color:rgb(102,102,102)">0</span><span class="p">,</span> <span class="n">EV_READ</span><span class="p">);</span>
  <span class="n">ev_io_start</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">stdin_watcher</span><span class="p">);</span>

  <span class="c1" style="color:rgb(64,128,128); font-style:italic">// initialise a timer watcher, then start it
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>  <span class="c1" style="color:rgb(64,128,128); font-style:italic">// simple non-repeating 5.5 second timeout
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>  <span class="n">ev_timer_init</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">timeout_watcher</span><span class="p">,</span> <span class="n">timeout_cb</span><span class="p">,</span> <span class="mf" style="color:rgb(102,102,102)">5.5</span><span class="p">,</span> <span class="mf" style="color:rgb(102,102,102)">0.</span><span class="p">);</span>
  <span class="n">ev_timer_start</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">timeout_watcher</span><span class="p">);</span>

  <span class="c1" style="color:rgb(64,128,128); font-style:italic">// now wait for events to arrive
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>  <span class="n">ev_run</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="mi" style="color:rgb(102,102,102)">0</span><span class="p">);</span>

  <span class="c1" style="color:rgb(64,128,128); font-style:italic">// break was called, so exit
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>  <span class="k" style="color:rgb(0,128,0); font-weight:bold">return</span> <span class="mi" style="color:rgb(102,102,102)">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p style="margin-top:0.5em; margin-bottom:0.5em">这个例子首先创建了一个事件循环，然后注册了两个事件：读取标准输入事件和超时事件。在终端输入或超时后，结束事件循环。</p>
</div>
<div class="section" id="id3" style="font-family:Arial,sans-serif; font-size:14px; line-height:19px">
<h1 style="font-size:17px; font-family:'Microsoft Yahei',sans-serif; color:rgb(26,28,29)">
<a target="_blank" class="toc-backref" href="http://www.yeolar.com/note/2012/12/16/libev/#id7" style="color:rgb(26,28,29); text-decoration:none">事件循环</a></h1>
<p style="margin-top:0.5em; margin-bottom:0.5em">使用libev的核心是事件循环，可以用 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_default_loop</tt> 或 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_loop_new</tt> 函数创建循环，或者直接使用<tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">EV_DEFAULT</tt> 宏，区别是 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_default_loop</tt> 创建的事件循环不是线程安全的，而 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_loop_new</tt> 创建的事件循环不能捕捉信号和子进程的观察器。大多数情况下，可以像下面这样使用：</p>
<pre class="code c literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><span class="k" style="color:rgb(0,128,0); font-weight:bold">if</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">!</span><span class="n">ev_default_loop</span> <span class="p">(</span><span class="mi" style="color:rgb(102,102,102)">0</span><span class="p">))</span>
  <span class="n">fatal</span> <span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"could not initialise libev, bad $LIBEV_FLAGS in environment?"</span><span class="p">);</span>
</pre>
<p style="margin-top:0.5em; margin-bottom:0.5em">或者明确选择一个后端：</p>
<pre class="code c literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><span class="k" style="color:rgb(0,128,0); font-weight:bold">struct</span> <span class="n">ev_loop</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">epoller</span> <span class="o" style="color:rgb(102,102,102)">=</span> <span class="n">ev_loop_new</span> <span class="p">(</span><span class="n">EVBACKEND_EPOLL</span> <span class="o" style="color:rgb(102,102,102)">|</span> <span class="n">EVFLAG_NOENV</span><span class="p">);</span>
<span class="k" style="color:rgb(0,128,0); font-weight:bold">if</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">!</span><span class="n">epoller</span><span class="p">)</span>
  <span class="n">fatal</span> <span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"no epoll found here, maybe it hides under your chair"</span><span class="p">);</span>
</pre>
<p style="margin-top:0.5em; margin-bottom:0.5em">如果需要动态分配循环的话，建议使用 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_loop_new</tt> 和 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_loop_destroy</tt> 。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em">在创建子进程后，且想要使用事件循环时，需要先在子进程中调用 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_default_fork</tt> 或 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_loop_fork</tt> 来重新初始化后端的内核状态，它们分别对应 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_default_loop</tt> 和 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_loop_new</tt> 来使用。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em"><tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_run</tt> 启动事件循环。它的第二个参数为0时，将持续运行并处理循环直到没有活动的事件观察器或者调用了 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_break</tt> 。另外两个取值是 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">EVRUN_NOWAIT</tt> 和 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">EVRUN_ONCE</tt> 。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em"><tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_break</tt> 跳出事件循环（在全部已发生的事件处理完之后）。第二个参数为 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">EVBREAK_ONE</tt> 或 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">EVBREAK_ALL</tt>来指定跳出最内层的 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_run</tt> 或者全部嵌套的 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_run</tt> 。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em"><tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_suspend</tt> 和 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_resume</tt> 用来暂停和重启事件循环，比如在<span class='wp_keywordlink'><a href="http://www.xuebuyuan.com/" title="程序" target="_blank">程序</a></span>挂起的时候。</p>
</div>
<div class="section" id="id4" style="font-family:Arial,sans-serif; font-size:14px; line-height:19px">
<h1 style="font-size:17px; font-family:'Microsoft Yahei',sans-serif; color:rgb(26,28,29)">
<a target="_blank" class="toc-backref" href="http://www.yeolar.com/note/2012/12/16/libev/#id8" style="color:rgb(26,28,29); text-decoration:none">观察器</a></h1>
<p style="margin-top:0.5em; margin-bottom:0.5em">接下来创建观察器，它主要包括类型、触发条件和回调函数。将它注册到事件循环上，在满足注册的条件时，会触发观察器，调用它的回调函数。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em">上面的例子中已经包含了IO观察器和计时观察器，此外还有周期观察器、信号观察器、文件状态观察器等等。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em">初始化和设置观察器使用 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_init</tt> 和 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_TYPE_set</tt> ，也可以直接使用 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_TYPE_init</tt> 。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em">在特定事件循环上启动观察器使用 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_TYPE_start</tt> 。 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">ev_TYPE_stop</tt> 停止观察器，并且会释放内存。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em">libev中将观察器分为4种状态：初始化、启动/活动、等待、停止。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em">libev中的观察器还支持优先级。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em">不同类型的观察器就不详细解释了，只把官方的一些例子贴在这里吧。</p>
<div class="section" id="ev-io">
<h2 style="margin-left:1em; font-size:16px; font-family:'Microsoft Yahei',sans-serif; color:rgb(26,28,29)">
<a target="_blank" class="toc-backref" href="http://www.yeolar.com/note/2012/12/16/libev/#id9" style="color:rgb(26,28,29); text-decoration:none">ev_io</a></h2>
<p style="margin-top:0.5em; margin-bottom:0.5em">获取标准输入：</p>
<pre class="code c literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><span class="k" style="color:rgb(0,128,0); font-weight:bold">static</span> <span class="kt" style="color:rgb(176,0,64)">void</span>
<span class="nf" style="color:rgb(0,0,255)">stdin_readable_cb</span> <span class="p">(</span><span class="k" style="color:rgb(0,128,0); font-weight:bold">struct</span> <span class="n">ev_loop</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">loop</span><span class="p">,</span> <span class="n">ev_io</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">w</span><span class="p">,</span> <span class="kt" style="color:rgb(176,0,64)">int</span> <span class="n">revents</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ev_io_stop</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>
  <span class="p">..</span> <span class="n">read</span> <span class="n">from</span> <span class="n">stdin</span> <span class="n">here</span> <span class="p">(</span><span class="n">or</span> <span class="n">from</span> <span class="n">w</span><span class="o" style="color:rgb(102,102,102)">-&gt;</span><span class="n">fd</span><span class="p">)</span> <span class="n">and</span> <span class="n">handle</span> <span class="n">any</span> <span class="n">I</span><span class="o" style="color:rgb(102,102,102)">/</span><span class="n">O</span> <span class="n">errors</span>
<span class="p">}</span>

<span class="n">ev_io</span> <span class="n">stdin_readable</span><span class="p">;</span>
<span class="n">ev_io_init</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">stdin_readable</span><span class="p">,</span> <span class="n">stdin_readable_cb</span><span class="p">,</span> <span class="n">STDIN_FILENO</span><span class="p">,</span> <span class="n">EV_READ</span><span class="p">);</span>
<span class="n">ev_io_start</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">stdin_readable</span><span class="p">);</span>
</pre>
</div>
<div class="section" id="ev-timer">
<h2 style="margin-left:1em; font-size:16px; font-family:'Microsoft Yahei',sans-serif; color:rgb(26,28,29)">
<a target="_blank" class="toc-backref" href="http://www.yeolar.com/note/2012/12/16/libev/#id10" style="color:rgb(26,28,29); text-decoration:none">ev_timer</a></h2>
<p style="margin-top:0.5em; margin-bottom:0.5em">创建一个60s之后启动的计时器：</p>
<pre class="code c literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><span class="k" style="color:rgb(0,128,0); font-weight:bold">static</span> <span class="kt" style="color:rgb(176,0,64)">void</span>
<span class="nf" style="color:rgb(0,0,255)">one_minute_cb</span> <span class="p">(</span><span class="k" style="color:rgb(0,128,0); font-weight:bold">struct</span> <span class="n">ev_loop</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">loop</span><span class="p">,</span> <span class="n">ev_timer</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">w</span><span class="p">,</span> <span class="kt" style="color:rgb(176,0,64)">int</span> <span class="n">revents</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">..</span> <span class="n">one</span> <span class="n">minute</span> <span class="n">over</span><span class="p">,</span> <span class="n">w</span> <span class="n">is</span> <span class="n">actually</span> <span class="n">stopped</span> <span class="n">right</span> <span class="n">here</span>
<span class="p">}</span>

<span class="n">ev_timer</span> <span class="n">mytimer</span><span class="p">;</span>
<span class="n">ev_timer_init</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">mytimer</span><span class="p">,</span> <span class="n">one_minute_cb</span><span class="p">,</span> <span class="mf" style="color:rgb(102,102,102)">60.</span><span class="p">,</span> <span class="mf" style="color:rgb(102,102,102)">0.</span><span class="p">);</span>
<span class="n">ev_timer_start</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">mytimer</span><span class="p">);</span>
</pre>
<p style="margin-top:0.5em; margin-bottom:0.5em">创建一个10s超时的超时器：</p>
<pre class="code c literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><span class="k" style="color:rgb(0,128,0); font-weight:bold">static</span> <span class="kt" style="color:rgb(176,0,64)">void</span>
<span class="nf" style="color:rgb(0,0,255)">timeout_cb</span> <span class="p">(</span><span class="k" style="color:rgb(0,128,0); font-weight:bold">struct</span> <span class="n">ev_loop</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">loop</span><span class="p">,</span> <span class="n">ev_timer</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">w</span><span class="p">,</span> <span class="kt" style="color:rgb(176,0,64)">int</span> <span class="n">revents</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">..</span> <span class="n">ten</span> <span class="n">seconds</span> <span class="n">without</span> <span class="n">any</span> <span class="n">activity</span>
<span class="p">}</span>

<span class="n">ev_timer</span> <span class="n">mytimer</span><span class="p">;</span>
<span class="n">ev_timer_init</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">mytimer</span><span class="p">,</span> <span class="n">timeout_cb</span><span class="p">,</span> <span class="mf" style="color:rgb(102,102,102)">0.</span><span class="p">,</span> <span class="mf" style="color:rgb(102,102,102)">10.</span><span class="p">);</span> <span class="cm" style="color:rgb(64,128,128); font-style:italic">/* note, only repeat used */</span>
<span class="n">ev_timer_again</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">mytimer</span><span class="p">);</span> <span class="cm" style="color:rgb(64,128,128); font-style:italic">/* start timer */</span>
<span class="n">ev_run</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="mi" style="color:rgb(102,102,102)">0</span><span class="p">);</span>

<span class="c1" style="color:rgb(64,128,128); font-style:italic">// and in some piece of code that gets executed on any "activity":
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic">// reset the timeout to start ticking again at 10 seconds
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span><span class="n">ev_timer_again</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">mytimer</span><span class="p">);</span>
</pre>
</div>
<div class="section" id="ev-periodic">
<h2 style="margin-left:1em; font-size:16px; font-family:'Microsoft Yahei',sans-serif; color:rgb(26,28,29)">
<a target="_blank" class="toc-backref" href="http://www.yeolar.com/note/2012/12/16/libev/#id11" style="color:rgb(26,28,29); text-decoration:none">ev_periodic</a></h2>
<p style="margin-top:0.5em; margin-bottom:0.5em">创建一个小时为单位的周期定时器：</p>
<pre class="code c literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><span class="k" style="color:rgb(0,128,0); font-weight:bold">static</span> <span class="kt" style="color:rgb(176,0,64)">void</span>
<span class="nf" style="color:rgb(0,0,255)">clock_cb</span> <span class="p">(</span><span class="k" style="color:rgb(0,128,0); font-weight:bold">struct</span> <span class="n">ev_loop</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">loop</span><span class="p">,</span> <span class="n">ev_periodic</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">w</span><span class="p">,</span> <span class="kt" style="color:rgb(176,0,64)">int</span> <span class="n">revents</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">...</span> <span class="n">its</span> <span class="n">now</span> <span class="n">a</span> <span class="n">full</span> <span class="n">hour</span> <span class="p">(</span><span class="n">UTC</span><span class="p">,</span> <span class="n">or</span> <span class="n">TAI</span> <span class="n">or</span> <span class="n">whatever</span> <span class="n">your</span> <span class="n">clock</span> <span class="n">follows</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">ev_periodic</span> <span class="n">hourly_tick</span><span class="p">;</span>
<span class="n">ev_periodic_init</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">hourly_tick</span><span class="p">,</span> <span class="n">clock_cb</span><span class="p">,</span> <span class="mf" style="color:rgb(102,102,102)">0.</span><span class="p">,</span> <span class="mf" style="color:rgb(102,102,102)">3600.</span><span class="p">,</span> <span class="mi" style="color:rgb(102,102,102)">0</span><span class="p">);</span>
<span class="n">ev_periodic_start</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">hourly_tick</span><span class="p">);</span>
</pre>
<p style="margin-top:0.5em; margin-bottom:0.5em">或者自定义周期计算方式：</p>
<pre class="code c literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><span class="cp" style="color:rgb(188,122,0)">#include &lt;math.h&gt;
</span><span class="cp" style="color:rgb(188,122,0)"></span>
<span class="k" style="color:rgb(0,128,0); font-weight:bold">static</span> <span class="n">ev_tstamp</span>
<span class="nf" style="color:rgb(0,0,255)">my_scheduler_cb</span> <span class="p">(</span><span class="n">ev_periodic</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">w</span><span class="p">,</span> <span class="n">ev_tstamp</span> <span class="n">now</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k" style="color:rgb(0,128,0); font-weight:bold">return</span> <span class="n">now</span> <span class="o" style="color:rgb(102,102,102)">+</span> <span class="p">(</span><span class="mf" style="color:rgb(102,102,102)">3600.</span> <span class="o" style="color:rgb(102,102,102)">-</span> <span class="n">fmod</span> <span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="mf" style="color:rgb(102,102,102)">3600.</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">ev_periodic_init</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">hourly_tick</span><span class="p">,</span> <span class="n">clock_cb</span><span class="p">,</span> <span class="mf" style="color:rgb(102,102,102)">0.</span><span class="p">,</span> <span class="mf" style="color:rgb(102,102,102)">0.</span><span class="p">,</span> <span class="n">my_scheduler_cb</span><span class="p">);</span>
</pre>
<p style="margin-top:0.5em; margin-bottom:0.5em">如果想从当前时间开始：</p>
<pre class="code c literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><span class="n">ev_periodic</span> <span class="n">hourly_tick</span><span class="p">;</span>
<span class="n">ev_periodic_init</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">hourly_tick</span><span class="p">,</span> <span class="n">clock_cb</span><span class="p">,</span>
                  <span class="n">fmod</span> <span class="p">(</span><span class="n">ev_now</span> <span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="mf" style="color:rgb(102,102,102)">3600.</span><span class="p">),</span> <span class="mf" style="color:rgb(102,102,102)">3600.</span><span class="p">,</span> <span class="mi" style="color:rgb(102,102,102)">0</span><span class="p">);</span>
<span class="n">ev_periodic_start</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">hourly_tick</span><span class="p">);</span>
</pre>
</div>
<div class="section" id="ev-signal">
<h2 style="margin-left:1em; font-size:16px; font-family:'Microsoft Yahei',sans-serif; color:rgb(26,28,29)">
<a target="_blank" class="toc-backref" href="http://www.yeolar.com/note/2012/12/16/libev/#id12" style="color:rgb(26,28,29); text-decoration:none">ev_signal</a></h2>
<p style="margin-top:0.5em; margin-bottom:0.5em">在收到 <tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">SIGINT</tt> 时做些清理：</p>
<pre class="code c literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><span class="k" style="color:rgb(0,128,0); font-weight:bold">static</span> <span class="kt" style="color:rgb(176,0,64)">void</span>
<span class="nf" style="color:rgb(0,0,255)">sigint_cb</span> <span class="p">(</span><span class="k" style="color:rgb(0,128,0); font-weight:bold">struct</span> <span class="n">ev_loop</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">loop</span><span class="p">,</span> <span class="n">ev_signal</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">w</span><span class="p">,</span> <span class="kt" style="color:rgb(176,0,64)">int</span> <span class="n">revents</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ev_break</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">EVBREAK_ALL</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ev_signal</span> <span class="n">signal_watcher</span><span class="p">;</span>
<span class="n">ev_signal_init</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">signal_watcher</span><span class="p">,</span> <span class="n">sigint_cb</span><span class="p">,</span> <span class="n">SIGINT</span><span class="p">);</span>
<span class="n">ev_signal_start</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">signal_watcher</span><span class="p">);</span>
</pre>
</div>
<div class="section" id="ev-child">
<h2 style="margin-left:1em; font-size:16px; font-family:'Microsoft Yahei',sans-serif; color:rgb(26,28,29)">
<a target="_blank" class="toc-backref" href="http://www.yeolar.com/note/2012/12/16/libev/#id13" style="color:rgb(26,28,29); text-decoration:none">ev_child</a></h2>
<p style="margin-top:0.5em; margin-bottom:0.5em"><tt class="docutils literal" style="font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'">fork</tt> 一个新进程，给它安装一个child处理器等待进程结束：</p>
<pre class="code c literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><span class="n">ev_child</span> <span class="n">cw</span><span class="p">;</span>

<span class="k" style="color:rgb(0,128,0); font-weight:bold">static</span> <span class="kt" style="color:rgb(176,0,64)">void</span>
<span class="nf" style="color:rgb(0,0,255)">child_cb</span> <span class="p">(</span><span class="n">EV_P_</span> <span class="n">ev_child</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">w</span><span class="p">,</span> <span class="kt" style="color:rgb(176,0,64)">int</span> <span class="n">revents</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ev_child_stop</span> <span class="p">(</span><span class="n">EV_A_</span> <span class="n">w</span><span class="p">);</span>
  <span class="n">printf</span> <span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"process %d exited with status %x</span><span class="se" style="font-weight:bold; color:rgb(187,102,34)">\n</span><span class="s" style="color:rgb(186,33,33)">"</span><span class="p">,</span> <span class="n">w</span><span class="o" style="color:rgb(102,102,102)">-&gt;</span><span class="n">rpid</span><span class="p">,</span> <span class="n">w</span><span class="o" style="color:rgb(102,102,102)">-&gt;</span><span class="n">rstatus</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">pid_t</span> <span class="n">pid</span> <span class="o" style="color:rgb(102,102,102)">=</span> <span class="n">fork</span> <span class="p">();</span>

<span class="k" style="color:rgb(0,128,0); font-weight:bold">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o" style="color:rgb(102,102,102)">&lt;</span> <span class="mi" style="color:rgb(102,102,102)">0</span><span class="p">)</span>
  <span class="c1" style="color:rgb(64,128,128); font-style:italic">// error
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span><span class="k" style="color:rgb(0,128,0); font-weight:bold">else</span> <span class="k" style="color:rgb(0,128,0); font-weight:bold">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o" style="color:rgb(102,102,102)">==</span> <span class="mi" style="color:rgb(102,102,102)">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1" style="color:rgb(64,128,128); font-style:italic">// the forked child executes here
</span><span class="c1" style="color:rgb(64,128,128); font-style:italic"></span>    <span class="n">exit</span> <span class="p">(</span><span class="mi" style="color:rgb(102,102,102)">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="k" style="color:rgb(0,128,0); font-weight:bold">else</span>
  <span class="p">{</span>
    <span class="n">ev_child_init</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">cw</span><span class="p">,</span> <span class="n">child_cb</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="mi" style="color:rgb(102,102,102)">0</span><span class="p">);</span>
    <span class="n">ev_child_start</span> <span class="p">(</span><span class="n">EV_DEFAULT_</span> <span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">cw</span><span class="p">);</span>
  <span class="p">}</span>
</pre>
</div>
<div class="section" id="ev-stat">
<h2 style="margin-left:1em; font-size:16px; font-family:'Microsoft Yahei',sans-serif; color:rgb(26,28,29)">
<a target="_blank" class="toc-backref" href="http://www.yeolar.com/note/2012/12/16/libev/#id14" style="color:rgb(26,28,29); text-decoration:none">ev_stat</a></h2>
<p style="margin-top:0.5em; margin-bottom:0.5em">监控/etc/passwd是否有变化：</p>
<pre class="code c literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><span class="k" style="color:rgb(0,128,0); font-weight:bold">static</span> <span class="kt" style="color:rgb(176,0,64)">void</span>
<span class="nf" style="color:rgb(0,0,255)">passwd_cb</span> <span class="p">(</span><span class="k" style="color:rgb(0,128,0); font-weight:bold">struct</span> <span class="n">ev_loop</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">loop</span><span class="p">,</span> <span class="n">ev_stat</span> <span class="o" style="color:rgb(102,102,102)">*</span><span class="n">w</span><span class="p">,</span> <span class="kt" style="color:rgb(176,0,64)">int</span> <span class="n">revents</span><span class="p">)</span>
<span class="p">{</span>
  <span class="cm" style="color:rgb(64,128,128); font-style:italic">/* /etc/passwd changed in some way */</span>
  <span class="k" style="color:rgb(0,128,0); font-weight:bold">if</span> <span class="p">(</span><span class="n">w</span><span class="o" style="color:rgb(102,102,102)">-&gt;</span><span class="n">attr</span><span class="p">.</span><span class="n">st_nlink</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">printf</span> <span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"passwd current size  %ld</span><span class="se" style="font-weight:bold; color:rgb(187,102,34)">\n</span><span class="s" style="color:rgb(186,33,33)">"</span><span class="p">,</span> <span class="p">(</span><span class="kt" style="color:rgb(176,0,64)">long</span><span class="p">)</span><span class="n">w</span><span class="o" style="color:rgb(102,102,102)">-&gt;</span><span class="n">attr</span><span class="p">.</span><span class="n">st_size</span><span class="p">);</span>
      <span class="n">printf</span> <span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"passwd current atime %ld</span><span class="se" style="font-weight:bold; color:rgb(187,102,34)">\n</span><span class="s" style="color:rgb(186,33,33)">"</span><span class="p">,</span> <span class="p">(</span><span class="kt" style="color:rgb(176,0,64)">long</span><span class="p">)</span><span class="n">w</span><span class="o" style="color:rgb(102,102,102)">-&gt;</span><span class="n">attr</span><span class="p">.</span><span class="n">st_mtime</span><span class="p">);</span>
      <span class="n">printf</span> <span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"passwd current mtime %ld</span><span class="se" style="font-weight:bold; color:rgb(187,102,34)">\n</span><span class="s" style="color:rgb(186,33,33)">"</span><span class="p">,</span> <span class="p">(</span><span class="kt" style="color:rgb(176,0,64)">long</span><span class="p">)</span><span class="n">w</span><span class="o" style="color:rgb(102,102,102)">-&gt;</span><span class="n">attr</span><span class="p">.</span><span class="n">st_mtime</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="k" style="color:rgb(0,128,0); font-weight:bold">else</span>
    <span class="cm" style="color:rgb(64,128,128); font-style:italic">/* you shalt not abuse printf for puts */</span>
    <span class="n">puts</span> <span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"wow, /etc/passwd is not there, expect problems. "</span>
          <span class="s" style="color:rgb(186,33,33)">"if this is windows, they already arrived</span><span class="se" style="font-weight:bold; color:rgb(187,102,34)">\n</span><span class="s" style="color:rgb(186,33,33)">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>
<span class="n">ev_stat</span> <span class="n">passwd</span><span class="p">;</span>

<span class="n">ev_stat_init</span> <span class="p">(</span><span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">passwd</span><span class="p">,</span> <span class="n">passwd_cb</span><span class="p">,</span> <span class="s" style="color:rgb(186,33,33)">"/etc/passwd"</span><span class="p">,</span> <span class="mf" style="color:rgb(102,102,102)">0.</span><span class="p">);</span>
<span class="n">ev_stat_start</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="o" style="color:rgb(102,102,102)">&amp;</span><span class="n">passwd</span><span class="p">);</span>
</pre>
</div>
</div>
<div class="section" id="id5" style="font-family:Arial,sans-serif; font-size:14px; line-height:19px">
<h1 style="font-size:17px; font-family:'Microsoft Yahei',sans-serif; color:rgb(26,28,29)">
<a target="_blank" class="toc-backref" href="http://www.yeolar.com/note/2012/12/16/libev/#id15" style="color:rgb(26,28,29); text-decoration:none">其他功能</a></h1>
<p style="margin-top:0.5em; margin-bottom:0.5em">libev还支持很多其他的有用的功能，比如自定义观察器，在线程中使用等等，这些请看官方文档。</p>
</div>
<div class="section" id="python" style="font-family:Arial,sans-serif; font-size:14px; line-height:19px">
<h1 style="font-size:17px; font-family:'Microsoft Yahei',sans-serif; color:rgb(26,28,29)">
<a target="_blank" class="toc-backref" href="http://www.yeolar.com/note/2012/12/16/libev/#id16" style="color:rgb(26,28,29); text-decoration:none">Python绑定</a></h1>
<p style="margin-top:0.5em; margin-bottom:0.5em">libev提供了C和C++接口，很多其他语言也有对应的第三方接口。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em">libev的Python扩展是 <a target="_blank" class="reference external" href="http://code.google.com/p/pyev/" style="color:rgb(9,61,114); text-decoration:none">pyev</a> ，文档见 <a target="_blank" class="reference external" href="http://packages.python.org/pyev/" style="color:rgb(9,61,114); text-decoration:none">http://packages.python.org/pyev/</a> 。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em">libev中的基础功能在pyev中基本上都有对应的绑定。</p>
<p style="margin-top:0.5em; margin-bottom:0.5em">官方给了两个例子，如其中的展示基本用法的例子：</p>
<pre class="code py literal-block" style="margin:1em 2em; font-size:13px; line-height:normal; font-family:Consolas,monospace,'Dejavu Sans Mono','Courier New'; padding:0.5em; white-space:pre-wrap; border-left-width:4px; border-left-style:solid; border-left-color:rgb(176,202,218); max-height:600px; overflow:auto"><img src="http://www.yeolar.com/static/img/code_lineno.png" class="code_lineno" alt="" style="border-width:0px; max-width:100%; float:right; position:relative; z-index:1; top:-4px; line-height:0"><span class="kn" style="color:rgb(0,128,0); font-weight:bold">import</span> <span class="nn" style="font-weight:bold; color:rgb(0,0,255)">signal</span>
<span class="kn" style="color:rgb(0,128,0); font-weight:bold">import</span> <span class="nn" style="font-weight:bold; color:rgb(0,0,255)">pyev</span>

<span class="k" style="color:rgb(0,128,0); font-weight:bold">def</span> <span class="nf" style="color:rgb(0,0,255)">sig_cb</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="n">revents</span><span class="p">):</span>
    <span class="k" style="color:rgb(0,128,0); font-weight:bold">print</span><span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"got SIGINT"</span><span class="p">)</span>
    <span class="n">loop</span> <span class="o" style="color:rgb(102,102,102)">=</span> <span class="n">watcher</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">loop</span>
    <span class="c" style="color:rgb(64,128,128); font-style:italic"># optional - stop all watchers</span>
    <span class="k" style="color:rgb(0,128,0); font-weight:bold">if</span> <span class="n">loop</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">data</span><span class="p">:</span>
        <span class="k" style="color:rgb(0,128,0); font-weight:bold">print</span><span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"stopping watchers: {0}"</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">format</span><span class="p">(</span><span class="n">loop</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">data</span><span class="p">))</span>
        <span class="k" style="color:rgb(0,128,0); font-weight:bold">while</span> <span class="n">loop</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">loop</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">data</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">pop</span><span class="p">()</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="c" style="color:rgb(64,128,128); font-style:italic"># unloop all nested loop</span>
    <span class="k" style="color:rgb(0,128,0); font-weight:bold">print</span><span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"stopping the loop: {0}"</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">format</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span>
    <span class="n">loop</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">stop</span><span class="p">(</span><span class="n">pyev</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">EVBREAK_ALL</span><span class="p">)</span>

<span class="k" style="color:rgb(0,128,0); font-weight:bold">def</span> <span class="nf" style="color:rgb(0,0,255)">timer_cb</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="n">revents</span><span class="p">):</span>
    <span class="n">watcher</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">data</span> <span class="o" style="color:rgb(102,102,102)">+=</span> <span class="mi" style="color:rgb(102,102,102)">1</span>
    <span class="k" style="color:rgb(0,128,0); font-weight:bold">print</span><span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"timer.data: {0}"</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">format</span><span class="p">(</span><span class="n">watcher</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">data</span><span class="p">))</span>
    <span class="k" style="color:rgb(0,128,0); font-weight:bold">print</span><span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"timer.loop.iteration: {0}"</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">format</span><span class="p">(</span><span class="n">watcher</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">loop</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">iteration</span><span class="p">))</span>
    <span class="k" style="color:rgb(0,128,0); font-weight:bold">print</span><span class="p">(</span><span class="s" style="color:rgb(186,33,33)">"timer.loop.now(): {0}"</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">format</span><span class="p">(</span><span class="n">watcher</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">loop</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">now</span><span class="p">()))</span>

<span class="k" style="color:rgb(0,128,0); font-weight:bold">if</span> <span class="n">__name__</span> <span class="o" style="color:rgb(102,102,102)">==</span> <span class="s" style="color:rgb(186,33,33)">"__main__"</span><span class="p">:</span>
    <span class="n">loop</span> <span class="o" style="color:rgb(102,102,102)">=</span> <span class="n">pyev</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">default_loop</span><span class="p">()</span>
    <span class="c" style="color:rgb(64,128,128); font-style:italic"># initialise and start a repeating timer</span>
    <span class="n">timer</span> <span class="o" style="color:rgb(102,102,102)">=</span> <span class="n">loop</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">timer</span><span class="p">(</span><span class="mi" style="color:rgb(102,102,102)">0</span><span class="p">,</span> <span class="mi" style="color:rgb(102,102,102)">2</span><span class="p">,</span> <span class="n">timer_cb</span><span class="p">,</span> <span class="mi" style="color:rgb(102,102,102)">0</span><span class="p">)</span>
    <span class="n">timer</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">start</span><span class="p">()</span>
    <span class="c" style="color:rgb(64,128,128); font-style:italic"># initialise and start a Signal watcher</span>
    <span class="n">sig</span> <span class="o" style="color:rgb(102,102,102)">=</span> <span class="n">loop</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">sig_cb</span><span class="p">)</span>
    <span class="n">sig</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">loop</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">data</span> <span class="o" style="color:rgb(102,102,102)">=</span> <span class="p">[</span><span class="n">timer</span><span class="p">,</span> <span class="n">sig</span><span class="p">]</span> <span class="c" style="color:rgb(64,128,128); font-style:italic"># optional</span>
    <span class="c" style="color:rgb(64,128,128); font-style:italic"># now wait for events to arrive</span>
    <span class="n">loop</span><span class="o" style="color:rgb(102,102,102)">.</span><span class="n">start</span><span class="p">()</span></pre>
</div>
</div>

<div style="font-size:0px;height:0px;line-height:0px;margin:0;padding:0;clear:both"></div>														</div>
							</div>
			<div class="back_b">
				<a href="javascript:void(0);" onclick="history.back();">返回</a>
			</div>
			<div class="clear"></div>
			<!-- end: entry -->
			<i class="lt"></i>
			<i class="rt"></i>
		</div>
		<div class="entry_sb">
			<i class="lb"></i>
			<i class="rb"></i>
		</div>

                <!-- ad_down -->
                <div class="ad_h">
		<div class="ad_h_c">
<table>
<tr>
<td>
<script type="text/javascript">
    /*500宽矩形*/
    var cpro_id = "u1507413";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>

</td>
<td>

<script type="text/javascript">
    /*右侧小矩形*/
    var cpro_id = "u1507403";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>


</td>
</tr>
</table>
			<div class="clear"></div>
		</div>
	<i class="lt"></i>
	<i class="rt"></i>
</div>
<div class="entry_box_b">
	<i class="lb"></i>
	<i class="rb"></i>
</div>

		<!-- ad -->
		<div class="ad_h">
		<div class="ad_h_c">
			<p align="center"><table align="center" width="90%">
<tr>
<td>
<script type="text/javascript">
var cpro_id = "u1507366";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
</td>
<td>
<script type="text/javascript">
var cpro_id = "u1507366";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
</td>
</tr>
</table>

<script type="text/javascript">
/*双侧飘窗*/
var cpro_id = "u1507394";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/f.js" type="text/javascript"></script>

<script type="text/javascript">
    /*右下角悬浮视窗*/
var cpro_id = "u1533898";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/f.js" type="text/javascript"></script>

</p>
			<div class="clear"></div>
		</div>
	<i class="lt"></i>
	<i class="rt"></i>
</div>
<div class="entry_box_b">
	<i class="lb"></i>
	<i class="rb"></i>
</div>
                <!-- tuijian -->
                <div class="ad_h">
		<div class="ad_h_c">
                        <h4>&nbsp;&nbsp;&nbsp;&nbsp;推荐文章:</h4> <table width="90%" style="margin:auto;">
<tr>
<td width="50%">
<li><a href = "http://www.xuebuyuan.com/1459418.html">Ubuntu安装QQ2010</a></li>
<li><a href = "http://www.xuebuyuan.com/1459420.html">Ubuntu 9.04 Server 搭建Nginx+PHP5+MySQL完美Web服务器</a></li>
<li><a href = "http://www.xuebuyuan.com/1459422.html">关于：HTTP Status 503 - This application is not currently available</a></li>
<li><a href = "http://www.xuebuyuan.com/1459424.html">Ubuntu 9.04 Server 搭建Lighttpd+PHP5+MySQL完美Web服务器</a></li>
<li><a href = "http://www.xuebuyuan.com/1459426.html">Ubuntu 9.04 Server搭建Cherokee+PHP5+MySQL完美Web服务器</a></li>
<li><a href = "http://www.xuebuyuan.com/1459428.html">详解ReWrite, BlockWrite, BlockRead 的用法</a></li>
<li><a href = "http://www.xuebuyuan.com/1459430.html">解决问题：java.lang.AbstractMethodError: com.microsoft.jdbc.base.BasePreparedStatement.getParameterMetaData...</a></li>
<li><a href = "http://www.xuebuyuan.com/1459432.html">u-boot启动之第2阶段浅析</a></li>
</td>
<td>
<li><a href = "http://www.xuebuyuan.com/1459419.html">内核LED驱动程序笔记</a></li>
<li><a href = "http://www.xuebuyuan.com/1459421.html">delphi中CreateMutex，OpenMutex使用一例</a></li>
<li><a href = "http://www.xuebuyuan.com/1459423.html">delphi中double或float转Integer实践</a></li>
<li><a href = "http://www.xuebuyuan.com/1459425.html">Ubuntu 9.04快速搭建Apache2(httpd)+PHP5+MySQL完美LAMP服务器</a></li>
<li><a href = "http://www.xuebuyuan.com/1459427.html">delphi中Label文字居中之方法</a></li>
<li><a href = "http://www.xuebuyuan.com/1459429.html">CreateFileMapping ,MapViewOfFile和OpenFileMapping的用法</a></li>
<li><a href = "http://www.xuebuyuan.com/1459431.html">#pragma 预处理指令详解</a></li>
<li><a href = "http://www.xuebuyuan.com/1459433.html">Ubuntu下获得root权限和设置静态IP（VM5.0/7.0）</a></li>
</td>
</tr>
</table>
			<div class="clear"></div>
		</div>
	<i class="lt"></i>
	<i class="rt"></i>
</div>
<div class="entry_box_b">
	<i class="lb"></i>
	<i class="rb"></i>
</div>

<!--
                <div class="ad_h">
		<div class="ad_h_c">
                        <h4>&nbsp;&nbsp;&nbsp;&nbsp;友情推荐:</h4> <table width="95%" style="margin:auto;">
<tr>
<td>
&nbsp;&nbsp;<a style="color: #0196e3;" href = "http://www.carcube.com.cn/chanpin/scjRx7XPRjPSx7HtzKjD5rDl.html">比亚迪F3仪表台面板</a>
&nbsp;&nbsp;<a style="color: #0196e3;" href = "http://www.carcube.com.cn/chanpin/scjRx7XPRjbSx7HtzKjD5rDl.html">比亚迪F6仪表台面板</a>
&nbsp;&nbsp;<a style="color: #0196e3;" href = "http://www.carcube.com.cn/chanpin/z8TA-9LHse3MqMPmsOU=.html">夏利仪表台面板</a>
&nbsp;&nbsp;<a style="color: #0196e3;" href = "http://www.carcube.com.cn/chanpin/0rvG-9LHse3MqMPmsOU=.html">一汽仪表台面板</a>
&nbsp;&nbsp;<a style="color: #0196e3;" href = "http://www.carcube.com.cn/chanpin/weXEvtLHse3MqMPmsOU=.html">铃木仪表台面板</a>
&nbsp;&nbsp;<a style="color: #0196e3;" href = "http://www.carcube.com.cn/chanpin/zb6529LHse3MqMPmsOU=.html">途观仪表台面板</a>

</td>
</tr>
</table>
			<div class="clear"></div>
		</div>
	<i class="lt"></i>
	<i class="rt"></i>
</div>
<div class="entry_box_b">
	<i class="lb"></i>
	<i class="rb"></i>
</div>

-->
		<div class="context_b">
			【上篇】<a href="http://www.xuebuyuan.com/442281.html" rel="prev">crash reporting system for Windows applications</a><br/>【下篇】<a href="http://www.xuebuyuan.com/8857.html" rel="next">为什么结婚戒指要戴在无名指上</a>			<i class="lt"></i>
			<i class="rt"></i>
			<i class="lb"></i>
			<i class="rb"></i>
		</div>
		<!-- relatedposts -->
								<!-- end: relatedposts -->
		<!-- entrymeta -->

		<div class="entrymeta">
			<div class="authorbio">
				<div class="author_pic">
<!--
					<img alt='' src='http://1.gravatar.com/avatar/92896e610fa51e444234c05761b7ac6e?s=48&amp;d=wavatar&amp;r=G' class='avatar avatar-48 photo' height='48' width='48' />-->
				</div>
				<div class="clear"></div>
				<div class="author_text">
					<h4>作者: <span><a href="http://www.xuebuyuan.com/author/causal" title="由causal发布" rel="author">causal</a></span></h4>
				</div>
			</div>
			<span class="spostinfo">
				<ul>
					<li>该日志由 causal 于3年前发表在综合分类下，最后更新于 2013年02月25日.</li>
					<li>转载请注明: <a href="http://www.xuebuyuan.com/1733575.html" rel="bookmark" title="本文固定链接 http://www.xuebuyuan.com/1733575.html">libev库的用法 | 学步园</a><a href="#" onclick="copy_code('http://www.xuebuyuan.com/1733575.html'); return false;"> +复制链接</a></li>
					<li class="content_tag"></li>
				</ul>
			</span>
			<i class="lt"></i>
			<i class="rt"></i>
			<div class="clear"></div>
		</div>
		<div class="entry_sb">
			<i class="lb"></i>
			<i class="rb"></i>
		</div>
		<!-- end: entrymeta -->
	<div class="ct"></div>
	<!-- You can start editing here. -->
			<!-- If comments are closed. -->
		<p class="nocomments">抱歉!评论已关闭.</p>
							</div>
<!-- end: content -->
<div id="sidebar">
	
						
		<div class="widget">
					</div>
		<div class="widget">
		<h3>本站推荐</h3>
<div class="box">
	<div class="scat_img"></div>
	<div id="scat">
				<ul>
			<li><a href="http://www.xuebuyuan.com/2201282.html" rel="bookmark" title="详细阅读作业的提交和监控（二）">作业的提交和监控（二）</a></li>
		</ul>
				<ul>
			<li><a href="http://www.xuebuyuan.com/2201280.html" rel="bookmark" title="详细阅读作业的提交和监控（一）">作业的提交和监控（一）</a></li>
		</ul>
				<ul>
			<li><a href="http://www.xuebuyuan.com/2198208.html" rel="bookmark" title="详细阅读Electric-fence 介绍">Electric-fence 介绍</a></li>
		</ul>
				<ul>
			<li><a href="http://www.xuebuyuan.com/2198206.html" rel="bookmark" title="详细阅读原子操作浅谈">原子操作浅谈</a></li>
		</ul>
				<ul>
			<li><a href="http://www.xuebuyuan.com/2198205.html" rel="bookmark" title="详细阅读C++模板显式实例化">C++模板显式实例化</a></li>
		</ul>
				<ul>
			<li><a href="http://www.xuebuyuan.com/2198204.html" rel="bookmark" title="详细阅读Hadoop Local 模式运行 Pipes 程序">Hadoop Local 模式运行 Pipes 程</a></li>
		</ul>
				<ul>
			<li><a href="http://www.xuebuyuan.com/2198202.html" rel="bookmark" title="详细阅读Hadoop I/O 上 SequenceFile 类在 Pipes 上的应用">Hadoop I/O 上 SequenceFile 类</a></li>
		</ul>
				<ul>
			<li><a href="http://www.xuebuyuan.com/2198273.html" rel="bookmark" title="详细阅读Boost &#8211; Function 分析">Boost &#8211; Function 分析</a></li>
		</ul>
			</div>
	<div class="clear"></div>
</div>
<div class="box-bottom">
	<i class="lb"></i>
	<i class="rb"></i>
</div>
<script type="text/javascript">
var c,_=Function;
with(o=document.getElementById("scat")){ innerHTML+=innerHTML; onmouseover=_("c=1"); onmouseout=_("c=0");}
(F=_("if(#%26||!c)#++,#%=o.scrollHeight>>1;setTimeout(F,#%26?10:3500);".replace(/#/g,"o.scrollTop")))();
</script><div class="random_r">
	<h3>随便看看</h3>
	<div class="box_r">
		<ul><ul class="random-post-link">
<li class="random-post-link">
<a href="http://www.xuebuyuan.com/zt/50754420.html" title="sql 2005 编写 存储过程">sql 2005 编写 存储过程</a>
</li>
<li class="random-post-link">
<a href="http://www.xuebuyuan.com/zt/50756195.html" title="shell变量">shell变量</a>
</li>
<li class="random-post-link">
<a href="http://www.xuebuyuan.com/zt/50756344.html" title="select控件">select控件</a>
</li>
<li class="random-post-link">
<a href="http://www.xuebuyuan.com/zt/50757768.html" title="png图片如何制作">png图片如何制作</a>
</li>
<li class="random-post-link">
<a href="http://www.xuebuyuan.com/zt/50759309.html" title="php 文件操作类">php 文件操作类</a>
</li>
<li class="random-post-link">
<a href="http://www.xuebuyuan.com/zt/50759665.html" title="字符串压缩">字符串压缩</a>
</li>
<li class="random-post-link">
<a href="http://www.xuebuyuan.com/zt/50761403.html" title="oracle 调用存储过程">oracle 调用存储过程</a>
</li>
<li class="random-post-link">
<a href="http://www.xuebuyuan.com/zt/50762842.html" title="opengl 函数">opengl 函数</a>
</li>
<li class="random-post-link">
<a href="http://www.xuebuyuan.com/zt/50764181.html" title="以太网摄像机">以太网摄像机</a>
</li>
<li class="random-post-link">
<a href="http://www.xuebuyuan.com/zt/50765310.html" title="自动填写表单代码">自动填写表单代码</a>
</li>
<ul>
</ul>
		<div class="clear"></div>
	</div>
	<div class="box-bottom">
		<i class="lb"></i>
		<i class="rb"></i>
	</div>
</div><div class="ad">
	<div class="ads">
	<div class="box_top">
		<i class="rt"></i>
		<i class="lt"></i>
	</div>
		<div class="ads_c"><p align="center"><script type="text/javascript">
var cpro_id="u2385005";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"220",rsi1:"500",pat:"6",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"1",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0",ptbg:"90",piw:"0",pih:"0",ptp:"0"}
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>

<script type="text/javascript">
    /*右侧悬停广告*/
    var cpro_id = "u2386663";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
</p>
			<div class="clear"></div>
		</div>
		<div class="box-bottom">
			<i class="lb"></i>
			<i class="rb"></i>
		</div>
	</div>
</div>	</div>

	
	
			
	<div class="widget">
			</div>

		<div class="widget">
					</div>
	
				<div class="clear"></div>

							</div><div class="clear"></div>
<div class="footer_top">
	<div id="menu">
		<div class="menu-%e5%af%bc%e8%88%aa-container"><ul id="menu-%e5%af%bc%e8%88%aa-1" class="menu"><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703978"><a href="http://www.xuebuyuan.com/category/web%e5%89%8d%e7%ab%af">web前端</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703980"><a href="http://www.xuebuyuan.com/category/%e6%95%b0%e6%8d%ae%e5%ba%93">数据库</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703982"><a href="http://www.xuebuyuan.com/category/%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80">编程语言</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703979"><a href="http://www.xuebuyuan.com/category/%e6%90%9c%e7%b4%a2%e6%8a%80%e6%9c%af">搜索技术</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1810308"><a href="http://www.xuebuyuan.com/aboutus">关于本站</a></li>
</ul></div>	</div>
	<h2 class="blogtitle">
	<a href="http://www.xuebuyuan.com/" title="学步园">返回首页</a></h2>
		<big class="lt"></big>
	<big class="rt"></big>
</div>
<!-- 页脚 -->
<div class="footer_bottom_a">
	Copyright &copy; 2013-2014 学步园&nbsp;&nbsp;保留所有权利.
		<big class="lb"></big>
	<big class="rb"></big>
</div>
<!-- 首页页脚 -->
 <div class="clear"></div>
</div>


</body></html>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fc0f0742eeb83d6ab6614a81723b00197' type='text/javascript'%3E%3C/script%3E"));
</script>
